{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">{% trans "My Certificates" %}</h3>
        </div>
        <div class="card-body">
          {% if certificates %}
          <div class="row">
            {% for certificate in certificates %}
            <div class="col-md-4 col-sm-6">
              <div class="card certificate-card {% if certificate.is_expired %}expired{% endif %}">
                <div class="certificate-preview" onclick="window.location='{% url 'certificates:view_certificate' certificate.unique_id %}'">
                  {% if certificate.pdf_file %}
                  <img src="{% url 'certificates:view_certificate' certificate.unique_id %}?thumbnail=1" alt="{{ certificate.certificate.title }}" class="img-fluid">
                  {% else %}
                  <div class="certificate-placeholder">
                    <i class="fas fa-certificate fa-4x"></i>
                  </div>
                  {% endif %}
                  
                  {% if certificate.is_expired %}
                  <div class="certificate-overlay">
                    <span class="expired-badge">{% trans "Expired" %}</span>
                  </div>
                  {% endif %}
                </div>
                <div class="card-body">
                  <h5 class="card-title">{{ certificate.certificate.title }}</h5>
                  <p class="card-text">
                    <small class="text-muted">
                      {% trans "Issued" %}: {{ certificate.issued_date|date:"F d, Y" }}
                      {% if certificate.expiration_date %}
                      <br>{% trans "Expires" %}: {{ certificate.expiration_date|date:"F d, Y" }}
                      {% endif %}
                    </small>
                  </p>
                  <div class="certificate-actions">
                    <a href="{% url 'certificates:download_certificate' certificate.unique_id %}" class="btn btn-sm btn-primary">
                      <i class="fas fa-download"></i> {% trans "Download" %}
                    </a>
                    
                    {% if certificate.certificate.allow_linkedin %}
                    <button class="btn btn-sm btn-info share-linkedin" data-certificate-id="{{ certificate.unique_id }}">
                      <i class="fab fa-linkedin"></i> {% trans "Share" %}
                    </button>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="alert alert-info">
            {% trans "You haven't earned any certificates yet. Complete your assigned sequences to earn certificates!" %}
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  $(function() {
    // LinkedIn sharing
    $('.share-linkedin').on('click', function() {
      var certificateId = $(this).data('certificate-id');
      var certificateUrl = '{% url "certificates:view_certificate" "CERTIFICATE_ID" %}'.replace('CERTIFICATE_ID', certificateId);
      
      // Open LinkedIn sharing dialog
      var linkedinUrl = 'https://www.linkedin.com/profile/add?startTask=CERTIFICATION_NAME&name=' + 
                        encodeURIComponent('{{ request.site.name }}') + 
                        '&organizationId=1&issueYear=' + new Date().getFullYear() + 
                        '&issueMonth=' + (new Date().getMonth() + 1) + 
                        '&certUrl=' + encodeURIComponent(window.location.origin + certificateUrl);
      
      window.open(linkedinUrl, '_blank');
      
      // Mark as shared
      $.post('{% url "certificates:share_linkedin" "CERTIFICATE_ID" %}'.replace('CERTIFICATE_ID', certificateId));
    });
  });
</script>
{% endblock %}

{% block extra_css %}
<style>
  .certificate-card {
    margin-bottom: 20px;
    transition: all 0.3s ease;
  }
  
  .certificate-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  
  .certificate-preview {
    position: relative;
    height: 200px;
    background-color: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    overflow: hidden;
  }
  
  .certificate-preview img {
    max-height: 100%;
    object-fit: contain;
  }
  
  .certificate-placeholder {
    color: #adb5bd;
  }
  
  .certificate-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .expired-badge {
    background-color: #dc3545;
    color: white;
    padding: 5px 10px;
    border-radius: 3px;
    font-weight: bold;
  }
  
  .certificate-actions {
    display: flex;
    justify-content: space-between;
  }
  
  .certificate-card.expired {
    opacity: 0.7;
  }
</style>
{% endblock %}
